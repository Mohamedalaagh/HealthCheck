{% extends 'layout.html' %}
{% block extra_styles %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='dashboard.css') }}">
{% endblock %}
{% block content %}
<div class="dashboard-container">
    <!-- Sidebar Section -->
    <div class="sidebar">
        <div class="user-info text-center">
            <!-- User Image with Default Placeholder -->
            <img src="{{ current_user.image_file if current_user.image_file else url_for('static', filename='images/default_image.png') }}" 
                 alt="User Image" 
                 class="user-img rounded-circle border border-light">
            <p class="username">{{ current_user.username }}</p>
            
            <!-- Sidebar Buttons to Toggle Sections -->
            <button class="btn btn-primary mt-3" style="background-color: #28a745; border-color: #28a745; font-size: 1.1rem;" onclick="showSection('edit-info')">‚úèÔ∏è Edit Info</button>
            <button class="btn btn-primary mt-3" style="font-size: 1.2rem;" onclick="showSection('health-data-entry')">üìä Health Data Entry</button>
            <button class="btn btn-primary mt-3" style="font-size: 1.2rem;">üìà My Data Summary</button>
        </div>
    </div>

    <!-- Main Content Section -->
    <div class="main-content">
        <!-- Welcome Message (Default View) -->
        <div id="welcome-sections" class="welcome-message">
            <h1>Welcome to Your Dashboard, <span>{{ current_user.username }}</span>!</h1>
            <p>Your health data summary will be shown here.</p>
        </div>

        <!-- Health Data Entry Form -->
        <div id="health-data-entry" class="content-section" style="display:none;">
            <h2>Health Data Entry</h2>
            <form method="POST" action="{{ url_for('dashboard') }}">
                <label for="steps">Steps Walked:</label>
                <input type="number" name="steps" required>
                
                <label for="water">Water Intake (L):</label>
                <input type="number" step="0.1" name="water" required>
                
                <label for="sleep">Sleep Hours:</label>
                <input type="number" name="sleep" required>
                
                <label for="calories">Calories Consumed:</label>
                <input type="number" name="calories" required>
                
                <button type="submit" class="btn btn-success mt-3">Submit</button>
            </form>
        </div>

        <!-- Edit Personal Info Form -->
<!-- Edit Personal Info Form -->
<!-- Edit Personal Info Form -->
<div id="edit-info" class="content-section" style="display:none;">
    <h2>Edit Personal Info</h2>
    <form method="POST" action="{{ url_for('dashboard') }}" enctype="multipart/form-data">
        {{ profile_form.hidden_tag() }}  <!-- Add CSRF token -->
        
        <!-- First Name (Readonly with Gray Background) -->
        <label for="fname">First Name:</label>
        <input type="text" name="fname" value="{{ current_user.fname }}" readonly style="background-color: #f0f0f0; color: #666; cursor: not-allowed;">
        
        <!-- Last Name (Readonly with Gray Background) -->
        <label for="lname">Last Name:</label>
        <input type="text" name="lname" value="{{ current_user.lname }}" readonly style="background-color: #f0f0f0; color: #666; cursor: not-allowed;">
        
        <!-- Username (Editable) -->
        <div class="form-group">
            {{ profile_form.username.label(class="form-control-label") }}
            {% if profile_form.username.errors %}
                {{ profile_form.username(class="form-control form-control-lg is-invalid") }}
                <div class="invalid-feedback">
                    {% for error in profile_form.username.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% else %}
                {{ profile_form.username(class="form-control form-control-lg") }}
            {% endif %}
        </div>
        
        <!-- Email (Editable) -->
        <div class="form-group">
            {{ profile_form.email.label(class="form-control-label") }}
            {% if profile_form.email.errors %}
                {{ profile_form.email(class="form-control form-control-lg is-invalid") }}
                <div class="invalid-feedback">
                    {% for error in profile_form.email.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% else %}
                {{ profile_form.email(class="form-control form-control-lg") }}
            {% endif %}
        </div>
        
        <!-- Profile Picture (Dummy Field) -->
        <div class="form-group">
            <label for="image">Profile Picture:</label>
            <input type="file" name="image">
            <small class="text-muted">Profile picture upload is not functional yet.</small>
        </div>
        
        <!-- Submit Button -->
        <div class="form-group">
            <button type="submit" class="btn btn-success mt-3">Save Changes</button>
        </div>
    </form>
</div>
    </div>
</div>

<!-- JavaScript for Section Toggle -->
<script>
    function showSection(sectionId) {
    // Hide all sections
    document.querySelectorAll('.content-section').forEach(section => {
        section.style.display = 'none';
    });

    // Hide the welcome message
    document.getElementById('welcome-sections').style.display = 'none';

    // Show the selected section
    document.getElementById(sectionId).style.display = 'block';
}
</script>
{% endblock %}
